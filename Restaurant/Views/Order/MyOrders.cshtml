@model List<Restaurant.Models.Order>

@{
    ViewData["Title"] = "My Past Orders";
}

<div class="container mt-5">
    <h2 class="text-center mb-4">My Past Orders</h2>

    @if (Model == null || !Model.Any())
    {
        <p class="text-center">You have not placed any orders yet.</p>
    }
    else
    {
        foreach (var order in Model)
        {
            <div class="card mb-4">
                <div class="card-header">
                    <strong>Order Date:</strong> @(order.OrderDate == default ? "Not Available" : order.OrderDate.ToString("dd MMM yyyy hh:mm tt")) <br />
                    <strong>Status:</strong> @(string.IsNullOrWhiteSpace(order.Status) ? "Unknown" : order.Status)<br />
                    <strong>Invoice ID:</strong> @(string.IsNullOrWhiteSpace(order.InvoiceId) ? "N/A" : order.InvoiceId)<br />
                    <strong>Delivery Address:</strong> @(string.IsNullOrWhiteSpace(order.DeliveryAddress) ? "Not Provided" : order.DeliveryAddress)
                </div>
                <div class="card-body">
                    @if (order.OrderItems != null && order.OrderItems.Any())
                    {
                        <ul class="list-group">
                            @foreach (var item in order.OrderItems)
                            {
                                var itemName = item?.Item?.Name ?? "Item Not Found";
                                var itemQuantity = item?.Quantity ?? 0;
                                var itemPrice = item?.Item?.Price ?? 0m;
                                var itemTotal = itemPrice * itemQuantity;

                                <li class="list-group-item d-flex justify-content-between">
                                  <span>@($"{itemName} (x{itemQuantity})")</span>
                                    <span>₹@itemTotal.ToString("0.00")</span> 
                                </li>
                            }
                        </ul>

                        <div class="mt-3">
                            <strong>Total:</strong> ₹@order.TotalAmount.ToString("0.00") <br /> 
                            <strong>Payment Method:</strong> @(string.IsNullOrWhiteSpace(order.PaymentMethod) ? "Unknown" : order.PaymentMethod)
                        </div>
                    }
                    else
                    {
                        <p>No items found in this order.</p>
                    }
                </div>
            </div>
        }
    }
</div>
